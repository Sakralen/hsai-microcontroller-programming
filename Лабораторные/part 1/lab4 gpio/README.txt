Хороший исходник был потерян. Тут куча все намешано.